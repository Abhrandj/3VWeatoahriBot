{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="text-center">
  <h1 class="mb-4">Welcome to Your Trading Dashboard</h1>
</div>

<!-- Tambah Pair -->
<div class="row mb-4">
  <div class="col-lg-6 mx-auto">
    <form method="POST" class="input-group">
      <input type="text" class="form-control" name="pair" placeholder="Add New Pair (e.g. BTC-USDT)">
      <button class="btn btn-primary" type="submit">Add Pair</button>
    </form>
  </div>
</div>

<!-- Sinyal Strategi -->
<div class="row">
  {% for pair in pair_list %}
    {% set sig = signal.get(pair, {}) %}
    {% set strategy = sig.get('strategy_signal', 'N/A') %}
    {% set ai = sig.get('ai_signal', 'N/A') %}
    {% set tags = sig.get('tags', []) %}
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ pair }}</h5>

          <p><strong>Strategy Signal:</strong>
            <span class="badge 
              {% if 'BUY' in strategy %}bg-success
              {% elif 'SELL' in strategy %}bg-danger
              {% else %}bg-secondary
              {% endif %}">
              <i class="bi bi-circle-fill me-1"></i>{{ strategy }}
            </span>
          </p>

          <p><strong>AI Signal:</strong>
            <span class="badge 
              {% if 'BUY' in ai %}bg-success
              {% elif 'SELL' in ai %}bg-danger
              {% else %}bg-secondary
              {% endif %}"
              data-bs-toggle="tooltip" data-bs-placement="bottom" title="Predicted: {{ ai }}">
              <i class="bi bi-robot me-1"></i>
            </span>
          </p>

          <p><strong>Tags:</strong></p>
          <div class="mb-2">
            {% for tag in tags %}
              <span class="badge bg-info text-dark me-1">{{ tag }}</span>
            {% endfor %}
          </div>

        </div>
      </div>
    </div>
  {% endfor %}
</div>

<!-- ROI Cumulative Chart -->
<hr class="my-5">
<div class="row">
  <div class="col-lg-12">
    <h4 class="mb-3">Cumulative ROI Chart</h4>
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <img src="{{ url_for('dashboard.graph_file', filename='cumulative_roi.png') }}" 
             alt="ROI Chart" class="img-fluid">
      </div>
    </div>
  </div>
</div>

<!-- Tombol Kirim Laporan Harian -->
<form action="{{ url_for('dashboard.send_daily_report') }}" method="POST" class="text-end mt-4">
  <button type="submit" class="btn btn-outline-warning">
    <i class="bi bi-send-arrow-up me-1"></i> Kirim Daily Report ke Telegram
  </button>
</form>

<!-- Grafik Pair -->
<div class="row mt-5">
  {% for pair in pair_list %}
    <div class="col-lg-12 mb-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Chart untuk {{ pair }}</h5>
          <iframe src="{{ url_for('dashboard.graph_file', filename='chart_' ~ pair.replace('-', '').lower() ~ '.html') }}"
                  width="100%" height="450px" frameborder="0"></iframe>
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}